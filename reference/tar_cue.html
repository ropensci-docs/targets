<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Declare the rules that cue a target. — tar_cue • targets</title><!-- rOpenSci favicons --><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Declare the rules that cue a target. — tar_cue"><meta name="description" content="Declare the rules that mark a target as outdated."><meta property="og:description" content="Declare the rules that mark a target as outdated."><meta property="og:image" content="https://docs.ropensci.org/targets/logo.svg"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/orestbida/cookieconsent@v3.0.0/dist/cookieconsent.css"><script src="https://cdn.jsdelivr.net/gh/orestbida/cookieconsent@v3.0.0/dist/cookieconsent.umd.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><p><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></p></noscript></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">
    <a href="https://ropensci.org" class="external-link"><img src="https://ropensci.org/img/icon_short_white.svg" id="hexlogo" alt="rOpenSci"></a>
    <a class="navbar-brand me-2" href="../index.html">targets</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.8.0.9003</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/overview.html">Overview</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://books.ropensci.org/targets">Manual</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://books.ropensci.org/targets-design">Design</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/overview.html">An overview of targets</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ropensci/targets/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Declare the rules that cue a target.</h1>
      <small class="dont-index">Source: <a href="https://github.com/ropensci/targets/blob/master/R/tar_cue.R" class="external-link"><code>R/tar_cue.R</code></a></small>
      <div class="d-none name"><code>tar_cue.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Declare the rules that mark a target as outdated.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">tar_cue</span><span class="op">(</span></span>
<span>  mode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"thorough"</span>, <span class="st">"always"</span>, <span class="st">"never"</span><span class="op">)</span>,</span>
<span>  command <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  depend <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  format <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  repository <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  iteration <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  file <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  seed <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-mode">mode<a class="anchor" aria-label="anchor" href="#arg-mode"></a></dt>
<dd><p>Cue mode. If <code>"thorough"</code>, all the cues apply unless
individually suppressed. If <code>"always"</code>, then the target always
runs. If <code>"never"</code>, then the target does not run unless the
metadata does not exist or the last run errored.</p></dd>


<dt id="arg-command">command<a class="anchor" aria-label="anchor" href="#arg-command"></a></dt>
<dd><p>Logical, whether to rerun the target if command changed
since last time.</p></dd>


<dt id="arg-depend">depend<a class="anchor" aria-label="anchor" href="#arg-depend"></a></dt>
<dd><p>Logical, whether to rerun the target if the value of one
of the dependencies changed.</p></dd>


<dt id="arg-format">format<a class="anchor" aria-label="anchor" href="#arg-format"></a></dt>
<dd><p>Logical, whether to rerun the target if the user-specified
storage format changed. The storage format is user-specified through
<code><a href="tar_target.html">tar_target()</a></code> or <code><a href="tar_option_set.html">tar_option_set()</a></code>.</p></dd>


<dt id="arg-repository">repository<a class="anchor" aria-label="anchor" href="#arg-repository"></a></dt>
<dd><p>Logical, whether to rerun the target if the user-specified
storage repository changed. The storage repository is user-specified
through <code><a href="tar_target.html">tar_target()</a></code> or <code><a href="tar_option_set.html">tar_option_set()</a></code>.</p></dd>


<dt id="arg-iteration">iteration<a class="anchor" aria-label="anchor" href="#arg-iteration"></a></dt>
<dd><p>Logical, whether to rerun the target if the user-specified
iteration method changed. The iteration method is user-specified through
<code><a href="tar_target.html">tar_target()</a></code> or <code><a href="tar_option_set.html">tar_option_set()</a></code>.</p></dd>


<dt id="arg-file">file<a class="anchor" aria-label="anchor" href="#arg-file"></a></dt>
<dd><p>Logical, whether to rerun the target if the file(s) with the
return value changed or at least one is missing.</p></dd>


<dt id="arg-seed">seed<a class="anchor" aria-label="anchor" href="#arg-seed"></a></dt>
<dd><p>Logical, whether to rerun the target if pseudo-random
number generator seed either changed or is <code>NA</code>.
The reproducible deterministic target-specific
seeds are controlled by <code>tar_option_get("seed")</code> and the target names.
See <code><a href="tar_option_set.html">tar_option_set()</a></code> for details.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="target-invalidation-rules">Target invalidation rules<a class="anchor" aria-label="anchor" href="#target-invalidation-rules"></a></h2>


<p><code>targets</code> uses internal metadata and special cues
to decide whether a target is up to date (can skip)
or is outdated/invalidated (needs to rerun). By default,
<code>targets</code> moves through the following list of cues
and declares a target outdated if at least one is cue activated.</p><ol><li><p>There is no metadata record of the target.</p></li>
<li><p>The target errored last run.</p></li>
<li><p>The target has a different class than it did before.</p></li>
<li><p>The cue mode equals <code>"always"</code>.</p></li>
<li><p>The cue mode does not equal <code>"never"</code>.</p></li>
<li><p>The <code>command</code> metadata field (the hash of the R command)
is different from last time.</p></li>
<li><p>The <code>depend</code> metadata field (the hash of the immediate upstream
dependency targets and global objects) is different from last time.</p></li>
<li><p>The storage format is different from last time.</p></li>
<li><p>The iteration mode is different from last time.</p></li>
<li><p>A target's file (either the one in <code>_targets/objects/</code>
or a dynamic file) does not exist or changed since last time.</p></li>
</ol><p>The user can suppress many of the above cues using the <code>tar_cue()</code>
function, which creates the <code>cue</code> argument of <code><a href="tar_target.html">tar_target()</a></code>.
Cues objects also constitute more nuanced target invalidation rules.
The <code>tarchetypes</code> package has many such examples, including
<code><a href="https://docs.ropensci.org/tarchetypes/reference/tar_age.html" class="external-link">tar_age()</a></code>, <code><a href="https://docs.ropensci.org/tarchetypes/reference/tar_download.html" class="external-link">tar_download()</a></code>, <code><a href="https://docs.ropensci.org/tarchetypes/reference/tar_cue_age.html" class="external-link">tar_cue_age()</a></code>, <code><a href="https://docs.ropensci.org/tarchetypes/reference/tar_cue_force.html" class="external-link">tar_cue_force()</a></code>,
and <code><a href="https://docs.ropensci.org/tarchetypes/reference/tar_cue_skip.html" class="external-link">tar_cue_skip()</a></code>.</p>
    </div>
    <div class="section level2">
    <h2 id="dependency-based-invalidation-and-user-defined-functions">Dependency-based invalidation and user-defined functions<a class="anchor" aria-label="anchor" href="#dependency-based-invalidation-and-user-defined-functions"></a></h2>


<p>If the cue of a target has <code>depend = TRUE</code> (default) then the target
is marked invalidated/outdated when its upstream dependencies change.
A target's dependencies include upstream targets,
user-defined functions, and other global objects populated
in the target script file (default: <code>_targets.R</code>).
To determine if a given dependency changed
since the last run of the pipeline, <code>targets</code> computes hashes.
The hash of a target is computed on its files in storage
(usually a file in <code>_targets/objects/</code>). The hash of a
non-function global object dependency is computed directly on its
in-memory data. User-defined functions are hashed in the following way:</p><ol><li><p>Deparse the function with <code>targets:::tar_deparse_safe()</code>. This
function computes a string representation of the function
body and arguments. This string representation is invariant to
changes in comments and whitespace, which means
trivial changes to formatting do not cue targets to rerun.</p></li>
<li><p>Manually remove any literal pointers from the function string
using <code>targets:::mask_pointers()</code>. Such pointers arise from
inline compiled C/C++ functions.</p></li>
<li><p>Using static code analysis (i.e. <code><a href="tar_deps.html">tar_deps()</a></code>, which is based on
<code><a href="https://rdrr.io/pkg/codetools/man/findGlobals.html" class="external-link">codetools::findGlobals()</a></code>) identify any user-defined functions
and global objects that the current function depends on.
Append the hashes of those dependencies to the string representation
of the current function.</p></li>
<li><p>Compute the hash of the final string representation using
<code>targets:::hash_object()</code>.</p></li>
</ol><p>Above, (3) is important because user-defined functions
have dependencies of their own, such as other user-defined
functions and other global objects. (3) ensures that a change to
a function's dependencies invalidates the function itself, which
in turn invalidates any calling functions and any targets downstream
with the <code>depend</code> cue turned on.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other targets:
<code><a href="tar_target.html">tar_target</a>()</code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># The following target will always run when the pipeline runs.</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="tar_target.html">tar_target</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu">download_data</span><span class="op">(</span><span class="op">)</span>, cue <span class="op">=</span> <span class="fu">tar_cue</span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"always"</span><span class="op">)</span><span class="op">)</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start top-4 bottom-8">
            <div class="col-2"> <img id="footerlogo" src="https://ropensci.org/img/icon_short_white.svg"></div>
            <div class="col-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://github.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-github"></div></a>
                        <a href="https://github.com/ropenscilabs" target="_blank" class="external-link"><div class="icon fa fa-flask"></div></a>
                        <a href="https://hachyderm.io/@ropensci" target="_blank" class="external-link"><div class="icon fab fa-mastodon"></div></a>
                        <a href="https://vimeo.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-vimeo"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul><h5 class="bottom-2">About</h5>
                            <li><a href="https://ropensci.org/about" class="external-link">About rOpenSci</a></li>
                            <li><a href="https://ropensci.org/software-review" class="external-link">Software Review</a></li>
                            <li><a href="https://ropensci.org/about#team" class="external-link">Our Team</a></li>
                            <li><a href="https://ropensci.org/careers" class="external-link">Jobs</a></li>
                            <li><a href="https://ropensci.org/donate" class="external-link">Donate</a></li>
                            <li><a href="https://ropensci.org/contact" class="external-link">Contact Us</a></li>
                        </ul></div>
                    <div class="col-md-3 col-sm-4">
                        <ul><h5 class="bottom-2">Community</h5>
                            <li><a href="https://ropensci.org/community/" class="external-link">Our Community</a></li>
                            <li><a href="https://ropensci.org/commcalls/" class="external-link">Community calls</a></li>
                            <li><a href="https://ropensci.org/events/" class="external-link">Events</a></li>
                            <li><a href="https://discuss.ropensci.org/" class="external-link">Join the Discussion</a></li>
                            <li><a href="https://ropensci.org/code-of-conduct" class="external-link">Code of conduct</a></li>
                        </ul></div>
                    <div class="col-md-2 col-sm-4">
                        <ul><h5 class="bottom-2">Resources</h5>
                            <li><a href="https://ropensci.org/packages/" class="external-link">Packages</a></li>
                            <li><a href="https://ropensci.org/usecases/" class="external-link">Use Cases</a></li>
                            <li><a href="https://ropensci.org/talks-papers/" class="external-link">Talks &amp; Publications</a></li>
                            <li><a href="https://docs.ropensci.org/" class="external-link">Documentation</a></li>
                            <li><a href="https://ropensci.org/news/" class="external-link">Newsletter</a></li>
                            <li><a href="https://ropensci.org/how-to-cite-ropensci/" class="external-link">Cite rOpenSci</a></li>
                        </ul></div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" class="external-link">NumFOCUS</a>.</p>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->


    </footer></div>





  </body></html>

