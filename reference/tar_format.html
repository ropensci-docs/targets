<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Define a custom target storage format. — tar_format • targets</title><!-- rOpenSci favicons --><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Define a custom target storage format. — tar_format"><meta name="description" content="Define a custom target storage format for the
format argument of tar_target() or tar_option_set()."><meta property="og:description" content="Define a custom target storage format for the
format argument of tar_target() or tar_option_set()."><meta property="og:image" content="https://docs.ropensci.org/targets/logo.svg"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/orestbida/cookieconsent@v3.0.0/dist/cookieconsent.css"><script src="https://cdn.jsdelivr.net/gh/orestbida/cookieconsent@v3.0.0/dist/cookieconsent.umd.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><p><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></p></noscript></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">
    <a href="https://ropensci.org" class="external-link"><img src="https://ropensci.org/img/icon_short_white.svg" id="hexlogo" alt="rOpenSci"></a>
    <a class="navbar-brand me-2" href="../index.html">targets</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.8.0.9003</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/overview.html">Overview</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://books.ropensci.org/targets">Manual</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://books.ropensci.org/targets-design">Design</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/overview.html">An overview of targets</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ropensci/targets/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Define a custom target storage format.</h1>
      <small class="dont-index">Source: <a href="https://github.com/ropensci/targets/blob/master/R/tar_format.R" class="external-link"><code>R/tar_format.R</code></a></small>
      <div class="d-none name"><code>tar_format.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Define a custom target storage format for the
<code>format</code> argument of <code><a href="tar_target.html">tar_target()</a></code> or <code><a href="tar_option_set.html">tar_option_set()</a></code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">tar_format</span><span class="op">(</span></span>
<span>  read <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  write <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  marshal <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  unmarshal <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  convert <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  copy <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  substitute <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  repository <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-read">read<a class="anchor" aria-label="anchor" href="#arg-read"></a></dt>
<dd><p>A function with a single argument named <code>path</code>.
This function should read and return the target stored
at the file in the argument. It should have no side effects.
See the "Format functions" section for specific requirements.
If <code>NULL</code>, the <code>read</code> argument defaults to <code><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS()</a></code>.</p></dd>


<dt id="arg-write">write<a class="anchor" aria-label="anchor" href="#arg-write"></a></dt>
<dd><p>A function with two arguments: <code>object</code> and <code>path</code>,
in that order. This function should save the R object <code>object</code>
to the file path at <code>path</code> and have no other side effects.
The function need not return a value, but the file written to <code>path</code>
must be a single file, and it cannot be a directory.
See the "Format functions" section for specific requirements.
If <code>NULL</code>, the <code>write</code> argument defaults to <code><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS()</a></code>
with <code>version = 3</code>.</p></dd>


<dt id="arg-marshal">marshal<a class="anchor" aria-label="anchor" href="#arg-marshal"></a></dt>
<dd><p>A function with a single argument named <code>object</code>.
This function should marshal the R object and return
an in-memory object that can be exported to remote parallel workers.
It should not read or write any persistent files.
See the Marshalling section for details.
See the "Format functions" section for specific requirements.
If <code>NULL</code>, the <code>marshal</code> argument defaults to just
returning the original object without any modifications.</p></dd>


<dt id="arg-unmarshal">unmarshal<a class="anchor" aria-label="anchor" href="#arg-unmarshal"></a></dt>
<dd><p>A function with a single argument named <code>object</code>.
This function should unmarshal the (marshalled) R object and return
an in-memory object that is appropriate and valid for use
on a parallel worker. It should not read or write any persistent files.
See the Marshalling section for details.
See the "Format functions" section for specific requirements.
If <code>NULL</code>, the <code>unmarshal</code> argument defaults to just
returning the original object without any modifications.</p></dd>


<dt id="arg-convert">convert<a class="anchor" aria-label="anchor" href="#arg-convert"></a></dt>
<dd><p>The <code>convert</code> argument is a function
that accepts the object returned by the command of the target
and changes it into an acceptable format (e.g. can be
saved with the <code>read</code> function). The <code>convert</code>
ensures the in-memory copy
of an object during the running pipeline session
is the same as the copy of the object that is saved
to disk. The function should be idempotent, and it should
handle edge cases like <code>NULL</code> values (especially for
<code>error = "null"</code> in <code><a href="tar_target.html">tar_target()</a></code> or <code><a href="tar_option_set.html">tar_option_set()</a></code>).
If <code>NULL</code>, the <code>convert</code> argument defaults to just
returning the original object without any modifications.</p></dd>


<dt id="arg-copy">copy<a class="anchor" aria-label="anchor" href="#arg-copy"></a></dt>
<dd><p>The <code>copy</code> argument is a function
that accepts the object returned by the command of the target
and makes a deep copy in memory. This method does is relevant
to objects like <code>data.table</code>s that support in-place modification
which could cause unpredictable side effects from target
to target. In cases like these, the target should be deep-copied
before a downstream target attempts to use it (in the case of
<code>data.table</code> objects, using <code><a href="https://rdatatable.gitlab.io/data.table/reference/copy.html" class="external-link">data.table::copy()</a></code>).
If <code>NULL</code>, the <code>copy</code> argument defaults to just
returning the original object without any modifications.</p></dd>


<dt id="arg-substitute">substitute<a class="anchor" aria-label="anchor" href="#arg-substitute"></a></dt>
<dd><p>Named list of values to be inserted into the
body of each custom function in place of symbols in the body.
For example, if
<code>write = function(object, path) saveRDS(object, path, version = VERSION)</code>
and <code>substitute = list(VERSION = 3)</code>, then
the <code>write</code> function will actually end up being
<code>function(object, path) saveRDS(object, path, version = 3)</code>.</p>
<p>Please do not include temporary or sensitive information
such as authentication credentials.
If you do, then <code>targets</code> will write them
to metadata on disk, and a malicious actor could
steal and misuse them. Instead, pass sensitive information
as environment variables using <code><a href="tar_resources_custom_format.html">tar_resources_custom_format()</a></code>.
These environment variables only exist in the transient memory
spaces of the R sessions of the local and worker processes.</p></dd>


<dt id="arg-repository">repository<a class="anchor" aria-label="anchor" href="#arg-repository"></a></dt>
<dd><p>Deprecated. Use the <code>repository</code> argument of
<code><a href="tar_target.html">tar_target()</a></code> or <code><a href="tar_option_set.html">tar_option_set()</a></code> instead.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A character string of length 1 encoding the custom format.
You can supply this string directly to the <code>format</code>
argument of <code><a href="tar_target.html">tar_target()</a></code> or <code><a href="tar_option_set.html">tar_option_set()</a></code>.</p>
    </div>
    <div class="section level2">
    <h2 id="marshalling">Marshalling<a class="anchor" aria-label="anchor" href="#marshalling"></a></h2>


<p>If an object can only be used in the R session
where it was created, it is called "non-exportable".
Examples of non-exportable R objects are Keras models,
Torch objects, <code>xgboost</code> matrices, <code>xml2</code> documents,
<code>rstan</code> model objects, <code>sparklyr</code> data objects, and
database connection objects. These objects cannot be
exported to parallel workers (e.g. for <code><a href="tar_make_future.html">tar_make_future()</a></code>)
without special treatment. To send an non-exportable
object to a parallel worker, the object must be marshalled:
converted into a form that can be exported safely
(similar to serialization but not always the same).
Then, the worker must unmarshal the object: convert it
into a form that is usable and valid in the current R session.
Arguments <code>marshal</code> and <code>unmarshal</code> of <code>tar_format()</code>
let you control how marshalling and unmarshalling happens.</p>
    </div>
    <div class="section level2">
    <h2 id="format-functions">Format functions<a class="anchor" aria-label="anchor" href="#format-functions"></a></h2>


<p>In <code>tar_format()</code>, functions like <code>read</code>, <code>write</code>,
<code>marshal</code>, and <code>unmarshal</code> must be perfectly pure
and perfectly self-sufficient.
They must load or namespace all their own packages,
and they must not depend on any custom user-defined
functions or objects in the global environment of your pipeline.
<code>targets</code> converts each function to and from text,
so it must not rely on any data in the closure.
This disqualifies functions produced by <code><a href="https://rdrr.io/r/base/Vectorize.html" class="external-link">Vectorize()</a></code>,
for example.</p>
<p>The <code>write</code> function must write only a single file,
and the file it writes must not be a directory.</p>
<p>The functions to read and write the object
should not do any conversions on the object. That is the job
of the <code>convert</code> argument. The <code>convert</code> argument is a function
that accepts the object returned by the command of the target
and changes it into an acceptable format (e.g. can be
saved with the <code>read</code> function). Working with the <code>convert</code>
function is best because it ensures the in-memory copy
of an object during the running pipeline session
is the same as the copy of the object that is saved
to disk.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other storage:
<code><a href="tar_load.html">tar_load</a>()</code>,
<code><a href="tar_load_everything.html">tar_load_everything</a>()</code>,
<code><a href="tar_objects.html">tar_objects</a>()</code>,
<code><a href="tar_read.html">tar_read</a>()</code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># The following target is equivalent to the current superseded</span></span></span>
<span class="r-in"><span><span class="co"># tar_target(name, command(), format = "keras").</span></span></span>
<span class="r-in"><span><span class="co"># An improved version of this would supply a `convert` argument</span></span></span>
<span class="r-in"><span><span class="co"># to handle NULL objects, which are returned by the target if it</span></span></span>
<span class="r-in"><span><span class="co"># errors and the error argument of tar_target() is "null".</span></span></span>
<span class="r-in"><span><span class="fu"><a href="tar_target.html">tar_target</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  name <span class="op">=</span> <span class="va">keras_target</span>,</span></span>
<span class="r-in"><span>  command <span class="op">=</span> <span class="fu">your_function</span><span class="op">(</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  format <span class="op">=</span> <span class="fu">tar_format</span><span class="op">(</span></span></span>
<span class="r-in"><span>    read <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">path</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="fu">keras</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/keras/man/save_model_hdf5.html" class="external-link">load_model_hdf5</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">}</span>,</span></span>
<span class="r-in"><span>    write <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">path</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="fu">keras</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/keras/man/save_model_hdf5.html" class="external-link">save_model_hdf5</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">object</span>, filepath <span class="op">=</span> <span class="va">path</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">}</span>,</span></span>
<span class="r-in"><span>    marshal <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="fu">keras</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/keras/man/serialize_model.html" class="external-link">serialize_model</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">}</span>,</span></span>
<span class="r-in"><span>    unmarshal <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="fu">keras</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/keras/man/serialize_model.html" class="external-link">unserialize_model</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;tar_stem&gt; </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   name: keras_target </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   description:  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   command:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     your_function() </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   format: format_custom&amp;read=ZnVuY3Rpb24gKHBhdGgpIAp7CiAgICBrZXJhczo6bG9hZF9tb2RlbF9oZGY1KHBhdGgpCn0&amp;write=ZnVuY3Rpb24gKG9iamVjdCwgcGF0aCkgCnsKICAgIGtlcmFzOjpzYXZlX21vZGVsX2hkZjUob2JqZWN0ID0gb2JqZWN0LCBmaWxlcGF0aCA9IHBhdGgpCn0&amp;marshal=ZnVuY3Rpb24gKG9iamVjdCkgCnsKICAgIGtlcmFzOjpzZXJpYWxpemVfbW9kZWwob2JqZWN0KQp9&amp;unmarshal=ZnVuY3Rpb24gKG9iamVjdCkgCnsKICAgIGtlcmFzOjp1bnNlcmlhbGl6ZV9tb2RlbChvYmplY3QpCn0&amp;convert=&amp;copy=&amp;repository= </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   repository: local </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   iteration method: vector </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   error mode: stop </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   memory mode: persistent </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   storage mode: main </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   retrieval mode: main </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   deployment mode: worker </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   priority: 0 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   resources:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     list() </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   cue:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     mode: thorough</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     command: TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     depend: TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     format: TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     repository: TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     iteration: TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     file: TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     seed: TRUE </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   packages:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     targets</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     stats</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     graphics</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     grDevices</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     utils</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     datasets</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     methods</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     base </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   library:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     NULL</span>
<span class="r-in"><span><span class="co"># And the following is equivalent to the current superseded</span></span></span>
<span class="r-in"><span><span class="co"># tar_target(name, torch::torch_tensor(seq_len(4)), format = "torch"),</span></span></span>
<span class="r-in"><span><span class="co"># except this version has a `convert` argument to handle</span></span></span>
<span class="r-in"><span><span class="co"># cases when `NULL` is returned (e.g. if the target errors out</span></span></span>
<span class="r-in"><span><span class="co"># and the `error` argument is "null" in tar_target()</span></span></span>
<span class="r-in"><span><span class="co"># or tar_option_set())</span></span></span>
<span class="r-in"><span><span class="fu"><a href="tar_target.html">tar_target</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  name <span class="op">=</span> <span class="va">torch_target</span>,</span></span>
<span class="r-in"><span>  command <span class="op">=</span> <span class="fu">torch</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/torch/man/torch_tensor.html" class="external-link">torch_tensor</a></span><span class="op">(</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  format <span class="op">=</span> <span class="fu">tar_format</span><span class="op">(</span></span></span>
<span class="r-in"><span>    read <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">path</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="fu">torch</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/torch/man/torch_load.html" class="external-link">torch_load</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">}</span>,</span></span>
<span class="r-in"><span>    write <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">path</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="fu">torch</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/torch/man/torch_save.html" class="external-link">torch_save</a></span><span class="op">(</span>obj <span class="op">=</span> <span class="va">object</span>, path <span class="op">=</span> <span class="va">path</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">}</span>,</span></span>
<span class="r-in"><span>    marshal <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="va">con</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rawConnection.html" class="external-link">rawConnection</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/raw.html" class="external-link">raw</a></span><span class="op">(</span><span class="op">)</span>, open <span class="op">=</span> <span class="st">"wr"</span><span class="op">)</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://rdrr.io/r/base/on.exit.html" class="external-link">on.exit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/connections.html" class="external-link">close</a></span><span class="op">(</span><span class="va">con</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>      <span class="fu">torch</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/torch/man/torch_save.html" class="external-link">torch_save</a></span><span class="op">(</span><span class="va">object</span>, <span class="va">con</span><span class="op">)</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://rdrr.io/r/base/rawConnection.html" class="external-link">rawConnectionValue</a></span><span class="op">(</span><span class="va">con</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">}</span>,</span></span>
<span class="r-in"><span>    unmarshal <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="va">con</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rawConnection.html" class="external-link">rawConnection</a></span><span class="op">(</span><span class="va">object</span>, open <span class="op">=</span> <span class="st">"r"</span><span class="op">)</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://rdrr.io/r/base/on.exit.html" class="external-link">on.exit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/connections.html" class="external-link">close</a></span><span class="op">(</span><span class="va">con</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>      <span class="fu">torch</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/torch/man/torch_load.html" class="external-link">torch_load</a></span><span class="op">(</span><span class="va">con</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;tar_stem&gt; </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   name: torch_target </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   description:  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   command:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     torch::torch_tensor() </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   format: format_custom&amp;read=ZnVuY3Rpb24gKHBhdGgpIAp7CiAgICB0b3JjaDo6dG9yY2hfbG9hZChwYXRoKQp9&amp;write=ZnVuY3Rpb24gKG9iamVjdCwgcGF0aCkgCnsKICAgIHRvcmNoOjp0b3JjaF9zYXZlKG9iaiA9IG9iamVjdCwgcGF0aCA9IHBhdGgpCn0&amp;marshal=ZnVuY3Rpb24gKG9iamVjdCkgCnsKICAgIGNvbiA8LSByYXdDb25uZWN0aW9uKHJhdygpLCBvcGVuID0gIndyIikKICAgIG9uLmV4aXQoY2xvc2UoY29uKSkKICAgIHRvcmNoOjp0b3JjaF9zYXZlKG9iamVjdCwgY29uKQogICAgcmF3Q29ubmVjdGlvblZhbHVlKGNvbikKfQ&amp;unmarshal=ZnVuY3Rpb24gKG9iamVjdCkgCnsKICAgIGNvbiA8LSByYXdDb25uZWN0aW9uKG9iamVjdCwgb3BlbiA9ICJyIikKICAgIG9uLmV4aXQoY2xvc2UoY29uKSkKICAgIHRvcmNoOjp0b3JjaF9sb2FkKGNvbikKfQ&amp;convert=&amp;copy=&amp;repository= </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   repository: local </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   iteration method: vector </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   error mode: stop </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   memory mode: persistent </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   storage mode: main </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   retrieval mode: main </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   deployment mode: worker </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   priority: 0 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   resources:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     list() </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   cue:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     mode: thorough</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     command: TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     depend: TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     format: TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     repository: TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     iteration: TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     file: TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     seed: TRUE </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   packages:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     targets</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     stats</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     graphics</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     grDevices</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     utils</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     datasets</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     methods</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     base </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   library:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     NULL</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start top-4 bottom-8">
            <div class="col-2"> <img id="footerlogo" src="https://ropensci.org/img/icon_short_white.svg"></div>
            <div class="col-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://github.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-github"></div></a>
                        <a href="https://github.com/ropenscilabs" target="_blank" class="external-link"><div class="icon fa fa-flask"></div></a>
                        <a href="https://hachyderm.io/@ropensci" target="_blank" class="external-link"><div class="icon fab fa-mastodon"></div></a>
                        <a href="https://vimeo.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-vimeo"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul><h5 class="bottom-2">About</h5>
                            <li><a href="https://ropensci.org/about" class="external-link">About rOpenSci</a></li>
                            <li><a href="https://ropensci.org/software-review" class="external-link">Software Review</a></li>
                            <li><a href="https://ropensci.org/about#team" class="external-link">Our Team</a></li>
                            <li><a href="https://ropensci.org/careers" class="external-link">Jobs</a></li>
                            <li><a href="https://ropensci.org/donate" class="external-link">Donate</a></li>
                            <li><a href="https://ropensci.org/contact" class="external-link">Contact Us</a></li>
                        </ul></div>
                    <div class="col-md-3 col-sm-4">
                        <ul><h5 class="bottom-2">Community</h5>
                            <li><a href="https://ropensci.org/community/" class="external-link">Our Community</a></li>
                            <li><a href="https://ropensci.org/commcalls/" class="external-link">Community calls</a></li>
                            <li><a href="https://ropensci.org/events/" class="external-link">Events</a></li>
                            <li><a href="https://discuss.ropensci.org/" class="external-link">Join the Discussion</a></li>
                            <li><a href="https://ropensci.org/code-of-conduct" class="external-link">Code of conduct</a></li>
                        </ul></div>
                    <div class="col-md-2 col-sm-4">
                        <ul><h5 class="bottom-2">Resources</h5>
                            <li><a href="https://ropensci.org/packages/" class="external-link">Packages</a></li>
                            <li><a href="https://ropensci.org/usecases/" class="external-link">Use Cases</a></li>
                            <li><a href="https://ropensci.org/talks-papers/" class="external-link">Talks &amp; Publications</a></li>
                            <li><a href="https://docs.ropensci.org/" class="external-link">Documentation</a></li>
                            <li><a href="https://ropensci.org/news/" class="external-link">Newsletter</a></li>
                            <li><a href="https://ropensci.org/how-to-cite-ropensci/" class="external-link">Cite rOpenSci</a></li>
                        </ul></div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" class="external-link">NumFOCUS</a>.</p>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->


    </footer></div>





  </body></html>

